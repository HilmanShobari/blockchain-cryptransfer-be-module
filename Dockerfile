FROM node:18.12.1-alpine3.17 as builder
WORKDIR /home/node/app

COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build --development

FROM node:18.12.1-alpine3.17
ENV NODE_ENV=development

ENV ENV_SILENT=true
ENV HOST=0.0.0.0
ENV PORT=3355
ENV APP_KEY=cgL_ZdIvPxVsi3w5gnGcqoCgMRKEZPvK
ENV DRIVE_DISK=local
ENV APP_NAME=crypwal_be_sbtgeneral_module
ENV DB_CONNECTION=mysql
ENV MYSQL_HOST=192.169.1.4
ENV MYSQL_PORT=3306
ENV MYSQL_USER=devuser
ENV MYSQL_PASSWORD=pwdev123!
ENV MYSQL_DB_NAME=SBT
ENV RABBIT_USER='usrblockchain'
ENV RABBIT_PASS='usrblockchain'
ENV HOSTNAME='192.169.2.5'
ENV VHOST='/blockchain'
ENV SYMMETRIC_KEY='aW5pIHNlY3JldCBxb2luIGRpZ2l0YWwgaWQ='
ENV PRIVATE_KEY_EVM='a750b8eb9d06a408074697c4e4288c1fcf3f02fcb23c013b71c6633e449f6a2c'
ENV RPC_QOINPAY_BESU='http://192.172.2.3:38545'
ENV CONTRACT_ADDRESS_QOINPAY_BESU='0x4e80254BF0f6B28B2BBf3F838bdd90fe320EfEd6'
ENV PROXYADMIN_ADDRESS_QOINPAY_BESU='0x8Ee1Ab76dbC6D33a38134Dd36BBE282E2d73600A'
ENV PROXYCONTRACT_ADDRESS_QOINPAY_BESU='0x955476CB10e0B13C925e9eab629B50c8DdC3D470'

WORKDIR /home/node/app
COPY --from=builder /home/node/app/build .

RUN npm ci --development
EXPOSE 3355
CMD [ "node", "server.js" ]
